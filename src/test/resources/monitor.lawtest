test_message = "test message"

monitor = new Agent "monitor"
foo = new Agent "foo", monitor: monitor
bar = new Agent "bar", monitor: monitor

test0 = new Test "adopted", ->
    foo.init()
    assert monitor.message_from(foo) is "#{foo} is formed"

test1 = new Test "disconnected", ->
    after test0
    foo.dissolve()
    assert monitor.message_from(foo) is "#{foo} is dissolved"

test2 = new Test "sent/arrived", ->
    foo.send bar, test_message
    assert bar.message_from(foo) is test_message
    assert monitor.message_from(foo) is "#{foo} sent a message to #{bar}"
    assert monitor.message_from(bar) is "#{bar} receives a message from #{foo}"
